{% extends "layout.html" %}
{% block content %}

<div class="max-w-lg mx-auto px-4 py-8">
  <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200">
    <div class="text-center mb-10">
      <h1 class="text-3xl font-bold text-gray-800">Your Profile</h1>
      <p class="mt-2 text-gray-600 text-sm">
        Manage your account information
      </p>
    </div>

    <div class="space-y-7">
      <div>
        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
          Name
        </div>
        <div id="name" class="text-xl font-medium text-gray-900">—</div>
      </div>

      <div>
        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
          Email
        </div>
        <div id="email" class="text-xl font-medium text-gray-900">—</div>
      </div>

      <div>
        <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
          Member Since
        </div>
        <div id="created_at" class="text-xl font-medium text-gray-900">—</div>
      </div>

      <div class="pt-8 mt-4 border-t border-gray-200 flex flex-wrap gap-4">
        <a href="/my-books"
           class="px-7 py-3 bg-emerald-800 text-white font-semibold rounded-lg hover:bg-emerald-900 transition">
          My Listings
        </a>
        <a href="/"
           class="px-7 py-3 bg-gray-100 text-gray-800 font-semibold rounded-lg border border-gray-300 hover:bg-gray-200 transition">
          Browse Books
        </a>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
async function fetchProfile() {
  try {
    const response = await fetch('/auth/me');
    
    if (!response.ok) {
      window.location.href = '/login';
      return;
    }

    const user = await response.json();

    document.getElementById('name').textContent = user.full_name?.trim() || '—';
    document.getElementById('email').textContent = user.email || '—';

    if (user.created_at) {
      const date = new Date(user.created_at);
      document.getElementById('created_at').textContent = 
        date.toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'short', 
          day: 'numeric' 
        });
    } else {
      document.getElementById('created_at').textContent = '—';
    }
  } catch (err) {
    console.error('Profile load failed:', err);
    alert("Couldn't load your profile right now. Try again later?");
  }
}

window.addEventListener('DOMContentLoaded', fetchProfile);
</script>
{% endblock %}